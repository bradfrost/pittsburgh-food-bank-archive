/*!
 * Sync Listeners, v0.1
 *
 * Copyright (c) 2013-2014 Dave Olsen, http://dmolsen.com
 * Licensed under the MIT license
 *
 * The JavaScript component of the WebSocket set-up that supports syncing
 * navigation between browsers and content updates with the server.
 *
 * The WebSocket test is from Modernizr. It might be a little too strict for our purposes.
 * https://github.com/Modernizr/Modernizr/blob/master/feature-detects/websockets.js
 *
 */function connectPageFollowSync(){if("WebSocket"in window&&window.WebSocket.CLOSING===2){var e="Page Follow";wsn=new WebSocket("ws://"+host+":"+pageFollowPort+"/pagefollow");wsn.onopen=function(){wsnConnected=!0;$("#navSyncButton").attr("data-state","on");$("#navSyncButton").addClass("connected");$("#navSyncButton").addClass("active");$("#navSyncButton").html(e+" On")};wsn.onclose=function(){wsnConnected=!1;$("#navSyncButton").attr("data-state","off");if($("#navSyncButton").hasClass("connected")){$("#navSyncButton").removeClass("connected");$("#navSyncButton").removeClass("active")}$("#navSyncButton").html(e+" Disabled")};wsn.onmessage=function(e){var t=JSON.parse(e.data),n=document.getElementById("sg-viewport").contentWindow.location.href,r="http://"+host+t.url;n!=r&&document.getElementById("sg-viewport").contentWindow.location.replace(r)};wsn.onerror=function(){wsnConnected=!1;$("#navSyncButton").attr("data-state","off");if($("#navSyncButton").hasClass("connected")){$("#navSyncButton").removeClass("connected");$("#navSyncButton").removeClass("active")}$("#navSyncButton").html(e+" Disabled")}}}function connectAutoReloadSync(){if("WebSocket"in window&&window.WebSocket.CLOSING===2){var e="Auto-reload";wsc=new WebSocket("ws://"+host+":"+autoReloadPort+"/autoreload");wsc.onopen=function(){wscConnected=!0;$("#contentSyncButton").attr("data-state","on");$("#contentSyncButton").addClass("connected");$("#contentSyncButton").addClass("active");$("#contentSyncButton").html(e+" On")};wsc.onclose=function(){wscConnected=!1;$("#contentSyncButton").attr("data-state","off");if($("#contentSyncButton").hasClass("connected")){$("#contentSyncButton").removeClass("connected");$("#contentSyncButton").removeClass("active")}$("#contentSyncButton").html(e+" Disabled")};wsc.onmessage=function(){var e=window.location.protocol=="file:"?"*":window.location.protocol+"//"+window.location.host,t=JSON.stringify({reload:!0});document.getElementById("sg-viewport").contentWindow.postMessage(t,e)};wsc.onerror=function(){wscConnected=!1;$("#contentSyncButton").attr("data-state","off");if($("#contentSyncButton").hasClass("connected")){$("#contentSyncButton").removeClass("connected");$("#contentSyncButton").removeClass("active")}$("#contentSyncButton").html(e+" Disabled")}}}var wsn,wsnConnected=!1,wsc,wscConnected=!1,host=window.location.host!==""?window.location.host:"127.0.0.1";connectPageFollowSync();connectAutoReloadSync();$("#navSyncButton").click(function(){if($(this).attr("data-state")=="on"){wsn.close();$(this).attr("data-state","off");$(this).removeClass("connected");$(this).removeClass("active");$(this).html("Nav Sync Off")}else{connectPageFollow();$(this).attr("data-state","on");$(this).addClass("connected");$(this).addClass("active");$(this).html("Nav Sync On")}});$("#contentSyncButton").click(function(){if($(this).attr("data-state")=="on"){wsc.close();$(this).attr("data-state","off");$(this).removeClass("connected");$(this).removeClass("active");$(this).html("Content Sync Off")}else{connectAutoReloadSync();$(this).attr("data-state","on");$(this).addClass("connected");$(this).addClass("active");$(this).html("Content Sync On")}});