/*!
 * Code View Support for the Viewer - v0.1
 *
 * Copyright (c) 2013 Brad Frost, http://bradfrostweb.com & Dave Olsen, http://dmolsen.com
 * Licensed under the MIT license
 *
 */var codeViewer={codeActive:!1,tabActive:"e",encoded:"",mustache:"",css:"",ids:{e:"#sg-code-title-html",m:"#sg-code-title-mustache",c:"#sg-code-title-css"},targetOrigin:window.location.protocol==="file:"?"*":window.location.protocol+"//"+window.location.host,copyOnInit:!1,onReady:function(){$("body").addClass("code-ready");$("#sg-t-code").click(function(e){e.preventDefault();$("#sg-t-toggle").removeClass("active");$(this).hasClass("active")?codeViewer.closeCode():codeViewer.openCode()});codeViewer.codeContainerInit();var e=urlHandler.getRequestVars();if(e.view!==undefined&&(e.view==="code"||e.view==="c")){codeViewer.copyOnInit=e.copy!==undefined&&e.copy==="true"?!0:!1;codeViewer.openCode()}},toggleCode:function(){codeViewer.codeActive?codeViewer.closeCode():codeViewer.openCode()},openCode:function(){$("#sg-t-annotations").removeClass("active");annotationsViewer.commentsActive=!1;var e=JSON.stringify({commentToggle:"off"});document.getElementById("sg-viewport").contentWindow.postMessage(e,codeViewer.targetOrigin);annotationsViewer.slideComment(999);var e=JSON.stringify({codeToggle:"on"});document.getElementById("sg-viewport").contentWindow.postMessage(e,codeViewer.targetOrigin);codeViewer.codeActive=!0;$("#sg-t-code").addClass("active")},closeCode:function(){var e=JSON.stringify({codeToggle:"off"});document.getElementById("sg-viewport").contentWindow.postMessage(e,codeViewer.targetOrigin);codeViewer.codeActive=!1;codeViewer.slideCode($("#sg-code-container").outerHeight());$("#sg-t-code").removeClass("active")},codeContainerInit:function(){if(document.getElementById("sg-code-container")===null){$('<div id="sg-code-container" class="sg-view-container"></div>').html($("#code-template").html()).appendTo("body").css("bottom",-$(document).outerHeight());setTimeout(function(){$("#sg-code-container").addClass("anim-ready")},50)}$("body").delegate("#sg-code-close-btn","click",function(){codeViewer.closeCode();return!1});$(codeViewer.ids.e).click(function(){codeViewer.swapCode("e")});$(codeViewer.ids.m).click(function(){codeViewer.swapCode("m")});$(codeViewer.ids.c).click(function(){codeViewer.swapCode("c")})},swapCode:function(e){codeViewer.clearSelection();var t="",n=e=="c"?"css":"markup";$("#sg-code-fill").removeClass().addClass("language-"+n);e=="m"?t=codeViewer.mustache:e=="e"?t=codeViewer.encoded:e=="c"&&(t=codeViewer.css);$("#sg-code-fill").html(t).text();codeViewer.tabActive=e;Prism.highlightElement(document.getElementById("sg-code-fill"));$(".sg-code-title-active").removeClass("sg-code-title-active");$(codeViewer.ids[e]).toggleClass("sg-code-title-active")},selectCode:function(){if(codeViewer.codeActive){selection=window.getSelection();range=document.createRange();range.selectNodeContents(document.getElementById("sg-code-fill"));selection.removeAllRanges();selection.addRange(range)}},clearSelection:function(){codeViewer.codeActive&&(window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges())},slideCode:function(e){$("#sg-code-container").css("bottom",-e)},saveEncoded:function(){codeViewer.encoded=this.responseText;codeViewer.tabActive=="e"&&codeViewer.activateDefaultTab("e",this.responseText)},saveMustache:function(){codeViewer.mustache=this.responseText;codeViewer.tabActive=="m"&&codeViewer.activateDefaultTab("m",this.responseText)},saveCSS:function(){$("#sg-code-title-css").css("display","block");codeViewer.css=this.responseText;codeViewer.tabActive=="c"&&codeViewer.activateDefaultTab("c",this.responseText)},activateDefaultTab:function(e,t){var n="",r=e=="c"?"css":"markup";e=="m"?n="mustache":e=="e"?n="html":e=="c"&&(n="css");$(".sg-code-title-active").removeClass("sg-code-title-active");$("#sg-code-title-"+n).addClass("sg-code-title-active");$("#sg-code-fill").removeClass().addClass("language-"+r);$("#sg-code-fill").html(t).text();Prism.highlightElement(document.getElementById("sg-code-fill"));if(codeViewer.copyOnInit){codeViewer.selectCode();codeViewer.copyOnInit=!1}},updateCode:function(e,t,n,r,i){codeViewer.clearSelection();if(e.length!==0){var s="";$("#sg-code-lineage").css("display","block");for(var o=0;o<e.length;o++){s+=o===0?"":", ";var u=e[o].lineageState!=undefined?"sg-pattern-state "+e[o].lineageState:"";s+="<a href='"+e[o].lineagePath+"' class='"+u+"' data-patternPartial='"+e[o].lineagePattern+"'>"+e[o].lineagePattern+"</a>"}$("#sg-code-lineage-fill").html(s)}else $("#sg-code-lineage").css("display","none");if(t.length!==0){var a="";$("#sg-code-lineager").css("display","block");for(var o=0;o<t.length;o++){a+=o===0?"":", ";var u=t[o].lineageState!=undefined?"sg-pattern-state "+t[o].lineageState:"";a+="<a href='"+t[o].lineagePath+"' class='"+u+"' data-patternPartial='"+t[o].lineagePattern+"'>"+t[o].lineagePattern+"</a>"}$("#sg-code-lineager-fill").html(a)}else $("#sg-code-lineager").css("display","none");$("#sg-code-lineage-fill a, #sg-code-lineager-fill a").on("click",function(e){e.preventDefault();$("#sg-code-loader").css("display","block");var t=JSON.stringify({path:urlHandler.getFileName($(this).attr("data-patternpartial"))});document.getElementById("sg-viewport").contentWindow.postMessage(t,codeViewer.targetOrigin)});if(r!=""){$("#sg-code-patternstate").css("display","block");var f='<span class="sg-pattern-state '+r+'">'+r+"</span>";$("#sg-code-patternstate-fill").html(f)}else $("#sg-code-patternstate").css("display","none");$("#sg-code-lineage-patternname, #sg-code-lineager-patternname, #sg-code-patternstate-patternname").html(n);var l=urlHandler.getFileName(n),c=new XMLHttpRequest;c.onload=this.saveEncoded;c.open("GET",l.replace(/\.html/,".escaped.html")+"?"+(new Date).getTime(),!0);c.send();var h=new XMLHttpRequest;h.onload=this.saveMustache;h.open("GET",l.replace(/\.html/,".mustache")+"?"+(new Date).getTime(),!0);h.send();if(i){var p=new XMLHttpRequest;p.onload=this.saveCSS;p.open("GET",l.replace(/\.html/,".css")+"?"+(new Date).getTime(),!0);p.send()}codeViewer.slideCode(0);$("#sg-code-loader").css("display","none")},receiveIframeMessage:function(e){var t=typeof e.data!="string"?e.data:JSON.parse(e.data);if(window.location.protocol!=="file:"&&e.origin!==window.location.protocol+"//"+window.location.host)return;if(t.codeOverlay!==undefined)t.codeOverlay==="on"?codeViewer.updateCode(t.lineage,t.lineageR,t.patternPartial,t.patternState,t.cssEnabled):codeViewer.slideCode($("#sg-code-container").outerHeight());else if(t.keyPress!==undefined){if(t.keyPress=="ctrl+shift+c"){codeViewer.toggleCode();return!1}if(t.keyPress=="cmd+a"){codeViewer.selectCode();return!1}if(t.keyPress=="ctrl+shift+u"){if(codeViewer.codeActive){codeViewer.swapCode("m");return!1}}else if(t.keyPress=="ctrl+shift+y"){if(codeViewer.codeActive){codeViewer.swapCode("e");return!1}}else if(t.keyPress=="esc"&&codeViewer.codeActive){codeViewer.closeCode();return!1}}}};$(document).ready(function(){codeViewer.onReady()});window.addEventListener("message",codeViewer.receiveIframeMessage,!1);$("#sg-viewport").load(function(){if(codeViewer.codeActive){var e=JSON.stringify({codeToggle:"on"});document.getElementById("sg-viewport").contentWindow.postMessage(e,codeViewer.targetOrigin)}});jwerty.key("ctrl+shift+c",function(e){codeViewer.toggleCode();return!1});jwerty.key("cmd+a/ctrl+a",function(e){codeViewer.selectCode();return!1});jwerty.key("ctrl+shift+u",function(e){if(codeViewer.codeActive){codeViewer.swapCode("m");return!1}});jwerty.key("ctrl+shift+y",function(e){if(codeViewer.codeActive){codeViewer.swapCode("e");return!1}});jwerty.key("esc",function(e){if(codeViewer.codeActive){codeViewer.closeCode();return!1}});