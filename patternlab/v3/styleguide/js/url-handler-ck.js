/*!
 * URL Handler - v0.1
 *
 * Copyright (c) 2013-2014 Dave Olsen, http://dmolsen.com
 * Licensed under the MIT license
 *
 * Helps handle the initial iFrame source. Parses a string to see if it matches
 * an expected pattern in Pattern Lab. Supports Pattern Labs fuzzy pattern partial
 * matching style.
 *
 */var urlHandler={skipBack:!1,targetOrigin:window.location.protocol=="file:"?"*":window.location.protocol+"//"+window.location.host,getFileName:function(e){var t="patterns",n="";if(e===undefined)return n;if(e=="all")return"styleguide/html/styleguide.html";var r=e.indexOf("viewall-")!=-1?viewAllPaths:patternPaths,i=e.replace("viewall-",""),s=this.getPatternInfo(i,r),o=s[0],u=s[1];if(r[o]!==undefined&&r[o][u]!==undefined)n=r[o][u];else if(r[o]!==undefined)for(var a in r[o])if(a.indexOf(u)!=-1){n=r[o][a];break}if(n==="")return n;var f=/\//g;e.indexOf("viewall-")!=-1&&n!==""?n=t+"/"+n.replace(f,"-")+"/index.html":n!==""&&(n=t+"/"+n.replace(f,"-")+"/"+n.replace(f,"-")+".html");return n},getPatternInfo:function(e,t){var n=e.split("-"),r=1,i=n.length,s=n[0];while(t[s]===undefined&&r<i){s+="-"+n[r];r++}var o=e.slice(s.length+1,e.length);return[s,o]},getRequestVars:function(){var e=new function(e){if(e.length>1)for(var t,n=0,r=e.substr(1).split("&");n<r.length;n++){t=r[n].split("=");this[unescape(t[0])]=t.length>1?unescape(t[1]):""}}(window.location.search);return e},pushPattern:function(e,t){var n={pattern:e},r=urlHandler.getFileName(e),i=window.location.pathname;i=window.location.protocol==="file"?i.replace("/public/index.html","public/"):i.replace(/\/index\.html/,"/");var s=window.location.protocol+"//"+window.location.host+i+r;if(t!=s){var o=JSON.stringify({path:r});document.getElementById("sg-viewport").contentWindow.postMessage(o,urlHandler.targetOrigin)}else{var u=window.location.protocol=="file:"?null:window.location.protocol+"//"+window.location.host+window.location.pathname.replace("index.html","")+"?p="+e;history.pushState!=undefined&&history.pushState(n,null,u);document.getElementById("title").innerHTML="Pattern Lab - "+e;document.getElementById("sg-raw")!=undefined&&document.getElementById("sg-raw").setAttribute("href",urlHandler.getFileName(e))}},popPattern:function(e){var t,n=e.state;if(n===null){this.skipBack=!1;return}n!==null&&(t=n.pattern);var r="";r=this.getFileName(t);r===""&&(r="styleguide/html/styleguide.html");var i=JSON.stringify({path:r});document.getElementById("sg-viewport").contentWindow.postMessage(i,urlHandler.targetOrigin);document.getElementById("title").innerHTML="Pattern Lab - "+t;document.getElementById("sg-raw").setAttribute("href",urlHandler.getFileName(t));wsnConnected&&wsn.send('{"url": "'+r+'", "patternpartial": "'+t+'" }')}};window.onpopstate=function(e){urlHandler.skipBack=!0;urlHandler.popPattern(e)};