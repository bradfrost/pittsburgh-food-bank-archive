/*!
 * Annotations Support for Patterns - v0.3
 *
 * Copyright (c) 2013-2014 Dave Olsen, http://dmolsen.com
 * Licensed under the MIT license
 *
 */var annotationsPattern={commentsOverlayActive:!1,commentsOverlay:!1,commentsEmbeddedActive:!1,commentsEmbedded:!1,commentsGathered:{commentOverlay:"on",comments:{}},trackedElements:[],targetOrigin:window.location.protocol=="file:"?"*":window.location.protocol+"//"+window.location.host,gatherComments:function(){if(document.getElementById("sg-patterns")===null){var e=0;for(comment in comments.comments){var t=comments.comments[comment],n=document.querySelectorAll(t.el);if(n.length>0){e++;t.displaynumber=e;for(var r=0;r<n.length;++r)n[r].onclick=function(e){return function(t){if(annotationsPattern.commentsOverlayActive){t.preventDefault();t.stopPropagation();var n=JSON.stringify({displaynumber:e.displaynumber,el:e.el,title:e.title,comment:e.comment});parent.postMessage(n,annotationsPattern.targetOrigin)}}}(t)}}}else{var i=JSON.stringify({commentOverlay:"off"});parent.postMessage(i,annotationsPattern.targetOrigin)}},embedComments:function(e,t,n){var r=document.createElement("div");r.classList.add("sg-annotation");var i=document.createElement("h3"),s=document.createElement("p");i.innerHTML=t;s.innerHTML=n;r.appendChild(i);r.appendChild(s);var o=annotationsPattern.findParent(e),u=o.getElementsByClassName("sg-annotations");if(u.length>0)u[0].appendChild(r);else{var a=document.createElement("div");a.classList.add("sg-annotations");a.appendChild(r);o.appendChild(a)}},findParent:function(e){var t;if(e.parentNode.classList.contains("sg-pattern"))return e.parentNode;t=annotationsPattern.findParent(e.parentNode);return t},receiveIframeMessage:function(e){var t=typeof e.data!="string"?e.data:JSON.parse(e.data);if(window.location.protocol!="file:"&&e.origin!==window.location.protocol+"//"+window.location.host)return;if(t.resize!==undefined&&annotationsPattern.commentsOverlayActive)for(var n=0;n<annotationsPattern.trackedElements.length;++n){var r=annotationsPattern.trackedElements[n];if(window.getComputedStyle(r.element,null).getPropertyValue("max-height")=="0px"){r.element.firstChild.style.display="none";var i=JSON.stringify({annotationState:!1,displayNumber:r.displayNumber});parent.postMessage(i,annotationsPattern.targetOrigin)}else{r.element.firstChild.style.display="block";var i=JSON.stringify({annotationState:!0,displayNumber:r.displayNumber});parent.postMessage(i,annotationsPattern.targetOrigin)}}else if(t.commentToggle!==undefined){var n,s,o,u;annotationsPattern.commentsOverlayActive=!1;annotationsPattern.commentsEmbeddedActive=!1;t.commentToggle==="on"&&document.getElementById("sg-patterns")!==null?annotationsPattern.commentsEmbeddedActive=!0:t.commentToggle==="on"&&(annotationsPattern.commentsOverlayActive=!0);if(!annotationsPattern.commentsOverlayActive){s=document.querySelectorAll(".has-annotation");for(n=0;n<s.length;n++)s[n].classList.remove("has-annotation");s=document.querySelectorAll(".annotation-tip");for(n=0;n<s.length;n++)s[n].style.display="none"}if(!annotationsPattern.commentsEmbeddedActive){s=document.getElementsByClassName("sg-annotations");for(n=0;n<s.length;n++)s[n].style.display="none"}if(annotationsPattern.commentsOverlayActive){var a=0;for(n=0;n<comments.comments.length;n++){o=comments.comments[n];s=document.querySelectorAll(o.el);var f=!0;if(s.length){a++;for(k=0;k<s.length;k++){s[k].classList.add("has-annotation");var l=document.createElement("span");l.innerHTML=a;l.classList.add("annotation-tip");if(window.getComputedStyle(s[k],null).getPropertyValue("max-height")=="0px"){l.style.display="none";f=!1}annotationsPattern.trackedElements.push({itemel:o.el,element:s[k],displayNumber:a,state:f});s[k].insertBefore(l,s[k].firstChild)}}}var a=0;for(n=0;n<comments.comments.length;n++){var f=!0,o=comments.comments[n],s=document.querySelectorAll(o.el);if(s.length>0){a++;for(k=0;k<s.length;k++)window.getComputedStyle(s[k],null).getPropertyValue("max-height")=="0px"&&(f=!1);annotationsPattern.commentsGathered.comments[a]={el:o.el,title:o.title,comment:o.comment,number:a,state:f}}}var i=JSON.stringify(annotationsPattern.commentsGathered);parent.postMessage(i,annotationsPattern.targetOrigin)}else if(annotationsPattern.commentsEmbeddedActive&&!annotationsPattern.commentsEmbedded)for(n=0;n<comments.comments.length;n++){o=comments.comments[n];s=document.querySelectorAll(o.el);s.length>0&&annotationsPattern.embedComments(s[0],o.title,o.comment);annotationsPattern.commentsEmbedded=!0}else if(annotationsPattern.commentsEmbeddedActive&&annotationsPattern.commentsEmbedded){s=document.getElementsByClassName("sg-annotations");for(n=0;n<s.length;++n)s[n].style.display="block"}}}};annotationsPattern.gatherComments();window.addEventListener("message",annotationsPattern.receiveIframeMessage,!1);window.onbeforeunload=function(){var e=JSON.stringify({commentOverlay:"off"});parent.postMessage(e,annotationsPattern.targetOrigin)};jwerty.key("ctrl+shift+a",function(e){var t=JSON.stringify({keyPress:"ctrl+shift+a"});parent.postMessage(t,codePattern.targetOrigin);return!1});jwerty.key("esc",function(e){var t=JSON.stringify({keyPress:"esc"});parent.postMessage(t,codePattern.targetOrigin);return!1});