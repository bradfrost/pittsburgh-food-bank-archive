/*!
 * Annotations Support for the Viewer - v0.3
 *
 * Copyright (c) 2013 Brad Frost, http://bradfrostweb.com & Dave Olsen, http://dmolsen.com
 * Licensed under the MIT license
 *
 */var annotationsViewer={commentsActive:!1,targetOrigin:window.location.protocol==="file:"?"*":window.location.protocol+"//"+window.location.host,moveToOnInit:0,onReady:function(){$("body").addClass("comments-ready");$("#sg-t-annotations").click(function(e){e.preventDefault();$("#sg-t-toggle").removeClass("active");annotationsViewer.toggleComments()});annotationsViewer.commentContainerInit();var e=urlHandler.getRequestVars();if(e.view!==undefined&&(e.view==="annotations"||e.view==="a")){annotationsViewer.openComments();e.number!==undefined&&(annotationsViewer.moveToOnInit=e.number)}},toggleComments:function(){annotationsViewer.commentsActive?annotationsViewer.closeComments():annotationsViewer.openComments()},openComments:function(){$("#sg-t-code").removeClass("active");codeViewer.codeActive=!1;var e=JSON.stringify({codeToggle:"off"});document.getElementById("sg-viewport").contentWindow.postMessage(e,annotationsViewer.targetOrigin);codeViewer.slideCode(999);var e=JSON.stringify({commentToggle:"on"});document.getElementById("sg-viewport").contentWindow.postMessage(e,annotationsViewer.targetOrigin);annotationsViewer.commentsActive=!0;$("#sg-t-annotations").addClass("active")},closeComments:function(){annotationsViewer.commentsActive=!1;var e=JSON.stringify({commentToggle:"off"});document.getElementById("sg-viewport").contentWindow.postMessage(e,annotationsViewer.targetOrigin);annotationsViewer.slideComment($("#sg-annotation-container").outerHeight());$("#sg-t-annotations").removeClass("active")},commentContainerInit:function(){if(document.getElementById("sg-annotation-container")===null){$('<div id="sg-annotation-container" class="sg-view-container"></div>').html($("#annotations-template").html()).appendTo("body").css("bottom",-$(document).outerHeight());setTimeout(function(){$("#sg-annotation-container").addClass("anim-ready")},50)}$("body").delegate("#sg-annotation-close-btn","click",function(){annotationsViewer.commentsActive=!1;$("#sg-t-annotations").removeClass("active");annotationsViewer.slideComment($("#sg-annotation-container").outerHeight());var e=JSON.stringify({commentToggle:"off"});document.getElementById("sg-viewport").contentWindow.postMessage(e,annotationsViewer.targetOrigin);return!1})},slideComment:function(e){$("#sg-annotation-container").css("bottom",-e)},moveTo:function(e){if(document.getElementById("annotation-"+e)!==undefined){var t=document.getElementById("annotation-"+e).offsetTop;$("#sg-annotation-container").animate({scrollTop:t-10},600)}},updateComments:function(e){var t=document.getElementById("sg-comments-container");t.innerHTML!==""&&(t.innerHTML="");var n=Object.keys(e).length;if(n>0)for(i=1;i<=n;i++){var r=e[i].number,s=document.createElement("span");s.id="annotation-state-"+r;s.style.fontSize="0.8em";s.style.color="#666";e[i].state===!1&&(s.innerHTML=" hidden");var o=document.createElement("h2");o.innerHTML=r+". "+e[i].title;o.appendChild(s);var u=document.createElement("div");u.innerHTML=e[i].comment;var a=document.createElement("div");a.classList.add("sg-comment-container");a.id="annotation-"+r;a.appendChild(o);a.appendChild(u);t.appendChild(a)}else{var o=document.createElement("h2");o.innerHTML="No Annotations";var u=document.createElement("div");u.innerHTML="There are no annotations for this pattern.";var a=document.createElement("div");a.classList.add("sg-comment-container");a.appendChild(o);a.appendChild(u);t.appendChild(a)}annotationsViewer.slideComment(0);if(annotationsViewer.moveToOnInit!="0"){annotationsViewer.moveTo(annotationsViewer.moveToOnInit);annotationsViewer.moveToOnInit="0"}},receiveIframeMessage:function(e){var t=typeof e.data!="string"?e.data:JSON.parse(e.data);if(window.location.protocol!=="file:"&&e.origin!==window.location.protocol+"//"+window.location.host)return;if(t.commentOverlay!==undefined)t.commentOverlay==="on"?annotationsViewer.updateComments(t.comments):annotationsViewer.slideComment($("#sg-annotation-container").outerHeight());else if(t.annotationState!==undefined)document.getElementById("annotation-state-"+t.displayNumber).innerHTML=t.annotationState==1?"":" hidden";else if(t.displaynumber!==undefined)annotationsViewer.moveTo(t.displaynumber);else if(t.keyPress!==undefined){if(t.keyPress=="ctrl+shift+a"){annotationsViewer.toggleComments();return!1}if(t.keyPress=="esc"&&annotationsViewer.commentsActive){annotationsViewer.closeComments();return!1}}}};$(document).ready(function(){annotationsViewer.onReady()});window.addEventListener("message",annotationsViewer.receiveIframeMessage,!1);$("#sg-viewport").load(function(){if(annotationsViewer.commentsActive){var e=JSON.stringify({commentToggle:"on"});document.getElementById("sg-viewport").contentWindow.postMessage(e,annotationsViewer.targetOrigin)}});$("#sg-view li a").click(function(){$(this).parent().parent().removeClass("active");$(this).parent().parent().parent().parent().removeClass("active")});jwerty.key("ctrl+shift+a",function(e){annotationsViewer.toggleComments();return!1});jwerty.key("esc",function(e){if(annotationsViewer.commentsActive){annotationsViewer.closeComments();return!1}});