!function(a){"use strict";a.fn.paymentInfo=function(e){var s,n,t,r,i,d="paymentInfo";return t=a.map(["change","blur","keyup","keypress","keydown"],function(a){return a+"."+d}).join(" "),r={visa:/^4/,mc:/^5[1-5]/,amex:/^3(4|7)/,disc:/^6011/},n={getCreditCardType:function(e){var s;return a.each(r,function(a,n){return n.test(e)?(s=a,!1):void 0}),s},matchNumbers:function(e){var s=e.data("ccNumber")||e.val(),t=n.getCreditCardType(s);""!==e.val()?""!==t?a("."+i.cardImageClass).addClass(t):a("."+i.cardImageClass).removeClass().addClass(i.cardImageClass):a("."+i.cardImageClass).removeClass().addClass(i.cardImageClass).data("ccNumber",""),"amex"===t?(e.inputmask({mask:"9999 999999 99999",oncomplete:n.creditCardComplete}),a("."+i.cardCvvClass).inputmask({mask:"9999",oncomplete:n.cvvComplete})):(e.inputmask({mask:"9999 9999 9999 9999",oncomplete:n.creditCardComplete}),a("."+i.cardCvvClass).inputmask({mask:"999",oncomplete:n.cvvComplete})),""===e.val()&&a("."+i.fieldsetClass).find("input:gt(0)").val(""),void 0!==t&&(a(e).parents("."+i.fieldsetClass).removeClass("invalid shake"),a("."+i.cardInstructionClass).removeClass("invalid"))},creditCardComplete:function(){var e=a("."+i.cardNumberClass),s=e.inputmask("unmaskedvalue"),t=n.getCreditCardType(s);return void 0===t?(a(e).parents("."+i.fieldsetClass).addClass("invalid shake"),a("."+i.cardInstructionClass).addClass("invalid"),void n.updateInstruction(i.messageCardNumberError)):(e.bind("saveValues",function(){("amex"===t&&15===s.length||"amex"!==t&&16===s.length)&&e.data("ccNumber",s).val(s.substr(s.length-4,s.length))}),e.addClass("transitioning-out"),setTimeout(function(){e.removeClass("transitioning-out"),Modernizr.touch?e.trigger("saveValues").blur(function(){e.trigger("saveValues")}):e.bind("blur",function(){e.trigger("saveValues")}).blur(),e.addClass("full")},i.animationWait),setTimeout(function(){a("."+i.fieldsetClass).find("input:gt(0)").removeClass("hide")},i.animationWait),a(e).unbind("blur focus click keydown keypress").bind("focus click keydown",function(s){("focus"===s.type||"click"===s.type||s.shiftKey&&9===s.keyCode)&&(n.beginCreditCard(a(e)),n.updateInstruction(i.messageEnterCardNumber))}),void((window.navigator.standalone||!Modernizr.touch)&&(a("."+i.cardExpirationClass).focus().val(a.trim(a("."+i.cardExpirationClass).val())),n.updateInstruction(i.messageExpiration))))},expirationComplete:function(){a("."+i.cardImageClass).addClass("cvv2"),a("."+i.cardExpirationClass).addClass("full").unbind("keydown blur").bind("keydown",function(e){8===e.keyCode&&""===a(this).val()&&(a(this).removeClass("full"),(window.navigator.standalone||!Modernizr.touch)&&(a("."+i.cardNumberClass).focus(),n.updateInstruction(i.messageEnterCardNumber)))}),(window.navigator.standalone||!Modernizr.touch)&&setTimeout(function(){a("."+i.cardCvvClass).focus(),n.updateInstruction(i.messageCVV)},220),n.updateInstruction(i.messageCVV)},cvvComplete:function(){a("."+i.cardImageClass).removeClass("cvv2"),a("."+i.cardCvvClass).addClass("full").unbind("keydown blur").bind("keydown",function(e){(8===e.keyCode||9===e.keyCode)&&(""===a(this).val()&&(a(this).removeClass("full"),(window.navigator.standalone||!Modernizr.touch)&&(a("."+i.cardExpirationClass).focus(),n.updateInstruction(i.messageExpiration))),a("."+i.cardImageClass).removeClass("cvv2"))}),(window.navigator.standalone||!Modernizr.touch)&&(a("."+i.cardZipClass).focus(),n.updateInstruction(i.messageZip))},zipComplete:function(){a("."+i.cardZipClass).addClass("full").unbind("keydown blur").bind("keydown",function(e){8===e.keyCode&&""===a(this).val()&&(a(this).removeClass("full"),(window.navigator.standalone||!Modernizr.touch)&&(a("."+i.cardCvvClass).focus(),n.updateInstruction(i.messageCVV)))}).inputmask({mask:"99999"}),a("."+i.fieldsetClass).addClass("valid"),a("."+i.cardInstructionClass).addClass("valid"),n.updateInstruction(i.messageSuccess)},beginCreditCard:function(e){a(e).val(a(e).data("ccNumber")).addClass("transitioning-in"),setTimeout(function(){e.removeClass("transitioning-in full")},150),a(e).unbind("keypress blur").bind("keypress blur",function(s){if(13===s.keyCode||"blur"===s.type){var t=a(e).inputmask("unmaskedvalue"),r=n.getCreditCardType(t);("amex"===r&&15===t.length||"amex"!==r&&16===t.length)&&n.creditCardComplete()}}).unbind("focus click keydown"),a("."+i.fieldsetClass).find("input:gt(0)").addClass("hide")},updateInstruction:function(e){a(".card-instruction").html(e)}},s={init:function(e){return i=a.extend({},a.fn.paymentInfo.defaults,e),a.extend(a.inputmask.defaults,{placeholder:" ",showMaskOnHover:!1,overrideFocus:!0}),this.each(function(){a(this).find("label").addClass("hide").end().find("."+i.cardNumberClass).inputmask({mask:"9999 9999 9999 9999"}).before("<span class='"+i.cardImageClass+"'></span>").end().find("."+i.cardExpirationClass).inputmask({mask:"m/q",clearIncomplete:!0,oncomplete:n.expirationComplete}).addClass("hide").end().find("."+i.cardCvvClass).inputmask({mask:"999"}).addClass("hide").focus(function(){a("."+i.cardImageClass).addClass("cvv2")}).blur(function(){a("."+i.cardImageClass).removeClass("cvv2")}).end().find("."+i.cardZipClass).inputmask({mask:"99999",oncomplete:n.zipComplete}).addClass("hide").end(),i.cardInstruction&&a(this).after("<span class='"+i.cardInstructionClass+"'>"+i.messageEnterCardNumber+"</span>"),n.matchNumbers(a(this).find("."+i.cardNumberClass).eq(0))}).unbind("."+d).bind(t,function(){n.matchNumbers(a(this).find("."+i.cardNumberClass).eq(0))})},destroy:function(){return this.unbind("."+d)}},s[e]?s[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?a.error("Method does not exist in plugin"):s.init.apply(this,arguments)},a.fn.paymentInfo.defaults={fieldsetClass:"credit-card-group",cardImageClass:"card-image",cardCvvClass:"card-cvv",cardExpirationClass:"card-expiration",cardZipClass:"card-zip",cardNumberClass:"card-number",cardInstruction:!0,cardInstructionClass:"card-instruction",animationWait:600,focusDelay:200,messageEnterCardNumber:"Please enter your credit card number",messageCardNumberError:"Please enter a valid credit card number",messageExpiration:"Please enter your card's expiration month and year",messageExpirationError:"Please enter a valid month and year",messageCVV:"Please enter the three-digit CVV number found on the back of your card",messageCVVAmEx:"Please enter your four-digit CVV number on the front of your card",messageZip:"Please enter your billing zip code",messageSuccess:"Hooray! You've successfully filled out your credit card information."}}(jQuery),$(".credit-card-group").paymentInfo();